<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.class_ic.dao.LectureAddDAO">

	<insert id="insert" parameterType="com.class_ic.vo.LectureDTO">
	INSERT INTO class (classCode,email,classTitle,classStart,classOpenTime,classEnd,classCloseTime,classInviteCode)
	VALUES(#{classCode}, #{classTitle}, str_to_date(#{classStart},'%Y-%m-%d'),str_to_date(#{classOpenTime}, '%H:%i:%s'),str_to_date(#{classEnd},'%Y-%m-%d'),str_to_date(#{classCloseTime}, '%H:%i:%s'),#{classInviteCode}, #{email} );
	</insert>

	<select id="getlecture" resultType="com.class_ic.vo.LectureDTO">
		SELECT * FROM class WHERE email=#{email}
	</select>

	<select id="getlectureStudent" resultType="com.class_ic.vo.LectureDTO">
		SELECT c.classCode as classCode, c.classTitle as classTitle, c.classStart as classStart, c.classOpenTime as classOpenTime, c.classEnd as classEnd, c.classCloseTime as classCloseTime, c.classInviteCode as classInviteCode
		FROM ClassMember cm JOIN  Class c
		ON	cm.classCode=c.classCode
		WHERE	cm.email=#{email}
	</select>
	
	<insert id="inputMyClassCode">
	   INSERT INTO classmember (classCode)
	   SELECT #{classCode} FROM DUAL
	   WHERE NOT EXISTS (SELECT * FROM classmember WHERE classCode=#{classCode} AND email=#{email}
	</insert>

</mapper>